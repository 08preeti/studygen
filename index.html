<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Personalized Study Guide Generator</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">

  <!-- Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- Sanitizer -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="#">
        <span class="brand-mark">ğŸ“š</span>
        <span class="brand-text">StudyGen</span>
      </a>

      <nav class="nav">
        <a href="#features">Features</a>
        <a href="#builder">Builder</a>
        <a href="#preview">Preview</a>
      </nav>

      <div class="header-actions">
        <button id="signInBtn" class="cta ghost" type="button">Sign in</button>
        <button id="signOutBtn" class="cta ghost" type="button" style="display:none;">Sign out</button>
        <button id="darkModeToggle" class="cta ghost" type="button" aria-label="Toggle dark mode">ğŸŒ™</button>
        <span id="userInfo" style="margin-left:1rem; font-weight:600;"></span>

      </div>
    </div>
  </header>

  <main>
    <!-- Hero -->
    <section class="hero container">
      <div class="hero-text">
        <h1>
          Generate Your <span class="gradient-text">Personalized Study Guide</span>
        </h1>
        <p class="sub">
          Plan smarter, study better, and save time using AI-generated guides.
        </p>

        <div class="hero-quick">
          <div class="chip">ğŸ“š Subjects</div>
          <div class="chip">ğŸ“Œ Topics</div>
          <div class="chip">â³ Timelines</div>
          <div class="chip">âœ… Flashcards</div>
        </div>

        <a class="cta primary" href="#builder">ğŸš€ Get Started</a>
      </div>

      <div class="hero-art" aria-hidden="true">
        <div class="floating-card">
          <div class="card-title">Todayâ€™s Focus</div>
          <ul class="tiny-list">
            <li>Math â€“ Algebra</li>
            <li>Physics â€“ Motion</li>
            <li>Chemistry â€“ Atoms</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Features -->
    <section id="features" class="features container">
      <article class="feature">
        <div class="icon">ğŸ¤–</div>
        <h3>AI Powered</h3>
        <p>Get instant study guides tailored to your input.</p>
      </article>
      <article class="feature">
        <div class="icon">â°</div>
        <h3>Smart Timelines</h3>
        <p>Auto-generate schedules that fit your time.</p>
      </article>
      <article class="feature">
        <div class="icon">âœ…</div>
        <h3>Checklists</h3>
        <p>Stay organized with task-based guides.</p>
      </article>
      <article class="feature">
        <div class="icon">ğŸ“Š</div>
        <h3>Progress</h3>
        <p>Visualize study flow and completion rates.</p>
      </article>
    </section>

    <!-- Builder Form -->
    <section id="builder" class="builder container">
      <div class="builder-head">
        <h2>Build Your Guide</h2>
        <p class="muted">Enter details below ğŸ‘‡</p>
      </div>

      <form class="form" id="guideForm">
        <label class="field">
          <span>ğŸ“˜ Subject</span>
          <input id="subject" type="text" placeholder="e.g. Physics" required />
        </label>

        <label class="field">
          <span>ğŸ“Œ Topics</span>
          <input id="topics" type="text" placeholder="e.g. Motion, Force, Energy" required />
        </label>

        <label class="field">
          <span>â³ Time (hours)</span>
          <input id="time" type="number" min="1" placeholder="e.g. 5" required />
        </label>

        <div class="actions">
          <button class="cta primary" type="submit">Generate Guide</button>
          <button class="cta ghost" type="reset">Reset</button>
        </div>
      </form>
    </section>

    <!-- AI Output -->
    <section id="preview" class="preview container">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:1rem;">
        <h2>Your AI Study Guide</h2>
        <div class="preview-actions">
          <button id="copyBtn" class="cta ghost" type="button">Copy</button>
          <button id="downloadBtn" class="cta ghost" type="button">Download .txt</button>
          <button id="pdfBtn" class="cta ghost" type="button">Save as PDF</button>
        </div>
      </div>
      <div id="guideOutput" class="output-box">
        âœ¨ Fill the form above and click "Generate Guide"
      </div>
    </section>

    <!-- Internet Search Notes -->
    <section id="internetNotes" class="builder container" style="margin-top:1.5rem;">
      <div class="builder-head">
        <h2>ğŸŒ Search Info Online</h2>
        <p class="muted">Quickly fetch a concise summary from Wikipedia.</p>
      </div>

      <div style="display:flex; gap:0.6rem; align-items:center; margin-bottom:0.75rem;">
        <input id="searchQuery" type="text" placeholder="Enter topic (e.g. Photosynthesis)" style="flex:1; padding:.7rem; border-radius:8px; border:1px solid #ccc;">
        <button id="searchBtn" class="cta primary" type="button">ğŸ” Search</button>
      </div>

      <div id="searchResults" class="output-box">No results yet...</div>
    </section>

    <!-- Notes Section -->
    <section id="notes" class="builder container">
      <div class="builder-head">
        <h2>Your Notes</h2>
        <p class="muted">Write down your own study notes âœï¸</p>
      </div>

      <textarea id="notesInput" placeholder="Type your notes here..." rows="8"></textarea>

      <div class="actions">
        <button id="saveNotesBtn" class="cta primary" type="button">ğŸ’¾ Save Notes</button>
        <button id="clearNotesBtn" class="cta ghost" type="button">ğŸ—‘ Clear</button>
      </div>

      <div class="saved-notes">
        <h3>ğŸ“‘ Saved Notes</h3>
        <div id="notesOutput" class="output-box">No notes yet...</div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="site-footer container">
    <p>Built with â¤ï¸ using Generative AI | StudyGen</p>
  </footer>

  <!-- Scripts -->
  <script type="module">
    import { auth, provider, signInWithPopup, signOut } from "./src/firebase.js";
    const API_URL = "https://studygen-api.onrender.com"; // âœ… your Render backend
    // --- Guide Generator ---
    const form = document.getElementById("guideForm");
    const outputBox = document.getElementById("guideOutput");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const subject = document.getElementById("subject").value;
      const topics = document.getElementById("topics").value;
      const time = document.getElementById("time").value;

      outputBox.innerHTML = `<span class="loading-dots">Generating...</span>`;

      try {
        const res = await fetch(`${API_URL}/api/generate`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ subject, topics, time }),
        });

        if (!res.ok) throw new Error("Backend returned an error");

        const data = await res.json();
        const html = DOMPurify.sanitize(marked.parse(data.guide || "âš ï¸ No response from backend."));
        outputBox.innerHTML = html;
      } catch (error) {
        console.error(error);
        outputBox.textContent = "âŒ Error: Could not connect to backend.";
      }
    });

    // --- Dark Mode Toggle ---
    const toggleBtn = document.getElementById("darkModeToggle");
    const body = document.body;

    if (localStorage.getItem("theme") === "dark") {
      body.classList.add("dark");
      toggleBtn.textContent = "â˜€ï¸";
    }

    toggleBtn.addEventListener("click", () => {
      body.classList.toggle("dark");
      const isDark = body.classList.contains("dark");
      toggleBtn.textContent = isDark ? "â˜€ï¸" : "ğŸŒ™";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });

    // --- Search Info Online ---
    const searchBtn = document.getElementById("searchBtn");
    const searchQuery = document.getElementById("searchQuery");
    const searchResults = document.getElementById("searchResults");

    searchBtn.addEventListener("click", async () => {
      const q = searchQuery.value.trim();
      if (!q) {
        toast("âš ï¸ Enter a topic to search");
        return;
      }

      searchResults.innerHTML = `<span class="loading-dots">Searching...</span>`;

      try {
        const res = await fetch(`${API_URL}/api/search`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query: q }),
        });

        const data = await res.json();
        if (data.error) {
          searchResults.textContent = "âš ï¸ " + data.error;
        } else {
          const md = `# ${data.title}\n\n${data.extract}`;
          const html = DOMPurify.sanitize(marked.parse(md));
          searchResults.innerHTML = html;
        }
      } catch (err) {
        console.error(err);
        searchResults.textContent = "âŒ Error fetching information.";
      }
    });

    // --- Copy ---
    document.getElementById("copyBtn").addEventListener("click", async () => {
      const text = document.getElementById("guideOutput").innerText.trim();
      await navigator.clipboard.writeText(text);
      toast("Copied!");
    });

    // --- Download .txt ---
    document.getElementById("downloadBtn").addEventListener("click", () => {
      const text = document.getElementById("guideOutput").innerText.trim();
      const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `study-guide-${Date.now()}.txt`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // --- Save as PDF ---
    document.getElementById("pdfBtn").addEventListener("click", () => {
      window.print();
    });

    // --- Toast helper ---
    function toast(msg) {
      const t = document.createElement("div");
      t.textContent = msg;
      t.style.position = "fixed";
      t.style.bottom = "20px";
      t.style.left = "50%";
      t.style.transform = "translateX(-50%)";
      t.style.background = "rgba(0,0,0,0.8)";
      t.style.color = "#fff";
      t.style.padding = "8px 12px";
      t.style.borderRadius = "8px";
      t.style.zIndex = "9999";
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 1200);
    }

    // --- Notes Management ---
    const notesInput = document.getElementById("notesInput");
    const saveNotesBtn = document.getElementById("saveNotesBtn");
    const clearNotesBtn = document.getElementById("clearNotesBtn");
    const notesOutput = document.getElementById("notesOutput");

    window.addEventListener("DOMContentLoaded", () => {
      const saved = localStorage.getItem("studyNotes");
      if (saved) notesOutput.textContent = saved;
    });

    saveNotesBtn.addEventListener("click", () => {
      const text = notesInput.value.trim();
      if (!text) {
        toast("âš ï¸ Notes cannot be empty!");
        return;
      }
      localStorage.setItem("studyNotes", text);
      notesOutput.textContent = text;
      notesInput.value = "";
      toast("âœ… Notes saved!");
    });

    clearNotesBtn.addEventListener("click", () => {
      localStorage.removeItem("studyNotes");
      notesOutput.textContent = "No notes yet...";
      toast("ğŸ—‘ Notes cleared!");
    });


  // --- Google Sign-In ---
    const signInBtn = document.getElementById("signInBtn");
    const signOutBtn = document.getElementById("signOutBtn");
    const userInfo = document.getElementById("userInfo");

    signInBtn.addEventListener("click", async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        userInfo.textContent = `ğŸ‘‹ Hello, ${user.displayName}`;
        signInBtn.style.display = "none";
        signOutBtn.style.display = "inline-block";
        localStorage.setItem("user", JSON.stringify(user));
      } catch (error) {
        console.error("Login failed", error);
      }
    });

    signOutBtn.addEventListener("click", async () => {
      try {
        await signOut(auth);
        userInfo.textContent = "";
        signInBtn.style.display = "inline-block";
        signOutBtn.style.display = "none";
        localStorage.removeItem("user");
      } catch (error) {
        console.error("Logout failed", error);
      }
    });

    // --- Toast helper ---
    function toast(msg) {
      const t = document.createElement("div");
      t.textContent = msg;
      t.style.position = "fixed";
      t.style.bottom = "20px";
      t.style.left = "50%";
      t.style.transform = "translateX(-50%)";
      t.style.background = "rgba(0,0,0,0.8)";
      t.style.color = "#fff";
      t.style.padding = "8px 12px";
      t.style.borderRadius = "8px";
      t.style.zIndex = "9999";
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 1200);
    }
</script>
</body>
</html>


