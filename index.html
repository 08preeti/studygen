<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Personalized Study Guide Generator</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">

  <!-- Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- Sanitizer -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="#">
        <span class="brand-mark">ğŸ“š</span>
        <span class="brand-text">StudyGen</span>
      </a>

      <nav class="nav">
        <a href="#features">Features</a>
        <a href="#builder">Builder</a>
        <a href="#preview">Preview</a>
      </nav>

      <div class="header-actions">
        <button id="signInBtn" class="cta ghost" type="button">Sign in</button>
        <button id="signOutBtn" class="cta ghost" type="button" style="display:none;">Sign out</button>
        <button id="darkModeToggle" class="cta ghost" type="button" aria-label="Toggle dark mode">ğŸŒ™</button>
        <span id="userInfo" style="margin-left:1rem; font-weight:600;"></span>
      </div>
    </div>
  </header>

  <main>
    <!-- Hero -->
    <section class="hero container">
      <div class="hero-text">
        <h1>
          Generate Your <span class="gradient-text">Personalized Study Guide</span>
        </h1>
        <p class="sub">
          Plan smarter, study better, and save time using AI-generated guides.
        </p>
        <a class="cta primary" href="#builder">ğŸš€ Get Started</a>
      </div>
    </section>

    <!-- Builder Form -->
    <section id="builder" class="builder container">
      <div class="builder-head">
        <h2>Build Your Guide</h2>
        <p class="muted">Enter details below ğŸ‘‡</p>
      </div>

      <form class="form" id="guideForm">
        <label class="field">
          <span>ğŸ“˜ Subject</span>
          <input id="subject" type="text" placeholder="e.g. Physics" required />
        </label>
        <label class="field">
          <span>ğŸ“Œ Topics</span>
          <input id="topics" type="text" placeholder="e.g. Motion, Force, Energy" required />
        </label>
        <label class="field">
          <span>â³ Time (hours)</span>
          <input id="time" type="number" min="1" placeholder="e.g. 5" required />
        </label>
        <div class="actions">
          <button class="cta primary" type="submit">Generate Guide</button>
          <button class="cta ghost" type="reset">Reset</button>
        </div>
      </form>
    </section>

    <!-- AI Output -->
    <section id="preview" class="preview container">
      <h2>Your AI Study Guide</h2>
      <div id="guideOutput" class="output-box">
        âœ¨ Fill the form above and click "Generate Guide"
      </div>
    </section>

    <!-- Internet Search Notes -->
    <section id="internetNotes" class="builder container" style="margin-top:1.5rem;">
      <h2>ğŸŒ Search Info Online</h2>
      <input id="searchQuery" type="text" placeholder="Enter topic (e.g. Photosynthesis)">
      <button id="searchBtn" class="cta primary" type="button">ğŸ” Search</button>
      <div id="searchResults" class="output-box">No results yet...</div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="site-footer container">
    <p>Built with â¤ï¸ using Generative AI | StudyGen</p>
  </footer>

  <!-- Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

    // âœ… Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDe4oB2vKidDWZwVsB9Dbw3Nq1R_p5v3Gs",
      authDomain: "studygen-6f0f2.firebaseapp.com",
      projectId: "studygen-6f0f2",
      storageBucket: "studygen-6f0f2.appspot.com",
      messagingSenderId: "1014293468680",
      appId: "1:1014293468680:web:380626d3693abae7a2e3bd"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const API_URL = "https://studygen-api.onrender.com";

    // --- Guide Generator ---
    const form = document.getElementById("guideForm");
    const outputBox = document.getElementById("guideOutput");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const subject = document.getElementById("subject").value;
      const topics = document.getElementById("topics").value;
      const time = document.getElementById("time").value;
      outputBox.textContent = "Generating...";
      try {
        const res = await fetch(`${API_URL}/api/generate`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ subject, topics, time }),
        });
        const data = await res.json();
        outputBox.innerHTML = DOMPurify.sanitize(marked.parse(data.guide || "âš ï¸ No response"));
      } catch {
        outputBox.textContent = "âŒ Error connecting to backend.";
      }
    });

    // --- Search Wikipedia ---
    const searchBtn = document.getElementById("searchBtn");
    const searchQuery = document.getElementById("searchQuery");
    const searchResults = document.getElementById("searchResults");
    searchBtn.addEventListener("click", async () => {
      const q = searchQuery.value.trim();
      if (!q) return;
      searchResults.textContent = "Searching...";
      try {
        const res = await fetch(`${API_URL}/api/search`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query: q }),
        });
        const data = await res.json();
        searchResults.innerHTML = data.error ? "âš ï¸ " + data.error : DOMPurify.sanitize(marked.parse(`# ${data.title}\n\n${data.extract}`));
      } catch {
        searchResults.textContent = "âŒ Error fetching info.";
      }
    });

    // --- Google Sign-In ---
    const signInBtn = document.getElementById("signInBtn");
    const signOutBtn = document.getElementById("signOutBtn");
    const userInfo = document.getElementById("userInfo");

    signInBtn.addEventListener("click", async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        userInfo.textContent = `ğŸ‘‹ Hello, ${user.displayName}`;
        signInBtn.style.display = "none";
        signOutBtn.style.display = "inline-block";
        localStorage.setItem("user", JSON.stringify(user));
      } catch (err) {
        console.error("Login failed", err);
        alert("Login failed, check console");
      }
    });

    signOutBtn.addEventListener("click", async () => {
      await signOut(auth);
      userInfo.textContent = "";
      signInBtn.style.display = "inline-block";
      signOutBtn.style.display = "none";
      localStorage.removeItem("user");
    });

    // Restore session
    window.addEventListener("DOMContentLoaded", () => {
      const savedUser = localStorage.getItem("user");
      if (savedUser) {
        const user = JSON.parse(savedUser);
        userInfo.textContent = `ğŸ‘‹ Hello, ${user.displayName}`;
        signInBtn.style.display = "none";
        signOutBtn.style.display = "inline-block";
      }
    });
  </script>
</body>
</html>


